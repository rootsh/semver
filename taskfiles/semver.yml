version: '3'

tasks:
  default:
    cmds:
      - task: variables
        
  semver:
    desc: Semantic Version
    cmds:
      - echo {{.GIT_COMMIT}}
      - echo {{.GIT_MSG_PREFIX}}
      - git checkout main
      - git tag v{{.GIT_NEXT_VERSION}}
      - git push --tags
      - gh release create v{{.GIT_NEXT_VERSION}} --generate-notes
    vars:
      GIT_COMMIT:
        sh: git log -n 1 --format=%h
      GIT_MSG_PREFIX:
        sh: git log --format=%B -n 1 | cut -f1 -d':'
      GIT_CURRENT_VERSION:
        sh: git describe --tags --abbrev=0 2>/dev/null || echo v0.0.0
      GIT_NEXT_VERSION:
        sh: docker run --rm alpine/semver semver -c -i patch {{.GIT_CURRENT_VERSION}}
        